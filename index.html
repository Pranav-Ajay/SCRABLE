<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ANVESHAN INTELLIGENCE</title>

  <style>
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      padding-bottom: 60px; 
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr 3fr 1fr;
      min-height: 100vh;
    }
    .side{
     background-color: #4b3621;
     min-height: 100vh;  
     padding: 60px 20px 100px 70px;
     color: white;
   }

    .center{
     padding: 40px;
     padding-top: 80px;  
     display: flex;
     justify-content: center;
    }

    .form-box {
      width: 100%;
      max-width: 750px;
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0px 8px 25px rgba(0,0,0,0.4);
    }

    input, select, textarea {
      margin-bottom: 10px;
      padding: 8px;
      width: 100%;
      border-radius: 6px;
      border: 1px solid #aaa;
      box-sizing: border-box;
    }

    button {
      background: #013220;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 10px;
      font-size: 15px;
      cursor: pointer;
      width: 100%;
      margin-top: 8px;
    }

    button:hover {
      background: #d4af37;
      color: white;
    }

    .profile-box{
    text-align: left;
    padding: 35px 20px;
    border-radius: 50px;
    color: white;

    display: flex;
    flex-direction: column;
    align-items: flex-start;  
    gap: 15px;
   }

    #ds{
    width: 220px;
    height: auto;      
    border-radius: 50px;
    object-fit: contain; 
    display: block;
    align-self: center;
   }

    #de{
    width: 220px;
    height: 130px;
    border-radius: 20px;
    object-fit: cover;
    background: white;
    align-self: center;
  }

    #dis {
      display: none;
      position: fixed;
      bottom: 8%;
      left: 50%;
      transform: translateX(-50%);
      gap: 10px;
      align-items: center;
    }

    #chatInput {
      width: 500px;
      background-color: #BDC7D1;
      padding: 10px;
      border-radius: 20px;
      border: none;
    }
    
    .footer {
      bottom: 0;
      position: fixed;
      left: 0;
      width: 100%;
      background-color: #4b3621;;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
      text-align: center;
    }
    .menu-btn{
  position: fixed;
  background: transparent;
  top: 20px;
  left: 20px;
  width:10px;
  height:20px;
  font-size: 26px;
  color: white;
  padding: 10px 16px;
  border-radius: 12px;
  cursor: pointer;
  z-index: 2000;
}
    .menu-btn:hover{
  background: transparent;
}

.overlay{
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(3px);
  display: none;
  z-index: 1500;
}

.side-menu{
  position: fixed;
  top: 0;
  left: -320px;
  width: 300px;
  height: 100%;
  background: #4b3621; 
  transition: 0.3s ease;
  z-index: 1800;
  padding-top: 20px;
  box-shadow: 5px 0px 20px rgba(0,0,0,0.5);
  border-top-right-radius: 30px;
  border-bottom-right-radius: 30px;
}

.menu-header{
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
  color: white;
  border-bottom: 2px solid rgba(255,255,255,0.2);
}

.menu-header h2{
  font-size: 18px;
  letter-spacing: 2px;
  margin: 0;
}

.close-btn{
  font-size: 22px;
  background: none;
  border: none;
  color: white;
  cursor: pointer;
}

.side-menu a{
  display: block;
  padding: 15px 25px;
  text-decoration: none;
  font-size: 16px;
  font-weight: 500;
  color: white;
  transition: 0.2s;
}

  </style>
</head>

<body>

  <div class="layout">

    <div class="side">
      <ol id="y"></ol>
    </div>

    <div class="center">
      <div class="form-box">

        <h2 style="text-align:center;">Hi, please fill out these details</h2>

        <ol id="details">
          <li>Complainant Name: <input id="complainantName"></li>
          <li>Father/Husband Name: <input id="HusbandName"></li>
          <li>DOB: <input type="date" id="dob"></li>
          <li>Nationality: <input id="nation"></li>
          <li>Occupation: <input></li>
          <li>Age: <input type="number" min="13" id="age"></li>

          <li>Gender:
            <select>
              <option value="">Select</option>
              <option>Male</option>
              <option>Female</option>
              <option>Other</option>
            </select>
          </li>

          <li>Address: <input id="address"></li>
          <li>Phone: <input type="tel" pattern="\+91[0-9]{10}" placeholder="+911234567890" required></li>

          <li>Holiday:
            <select id="holiday">
              <option value="">Select</option>
              <option>Yes</option>
              <option>No</option>
              <option>No idea</option>
            </select>
          </li>

          <li>Holiday Name: <input></li>

          <li>Festival:
            <select id="festival">
              <option value="">Select</option>
              <option>Yes</option>
              <option>No</option>
              <option>No idea</option>
            </select>
          </li>

          <li>Festival Name: <input></li>

          <li>Weapon Used: <input id="weaponUsed"></li>
          <li>Date: <input type="date" id="date"></li>
          <li>Start Time: <input type="time" id="startTime"></li>
          <li>End Time: <input type="time" id="endTime"></li>

          <li>Time (Morning/Afternoon...): <input></li>
          <li>Place of Incident: <input></li>

          <li>Location of Incident: <input id="location"></li>
          <li>Type of Incident: <input id="incidentType"></li>
        </ol>

        <h3>FIR Details</h3>
        <textarea id="firDetails"></textarea>

        <h3>Is the victim alive?</h3>
        <select id="victimAlive">
          <option value="">Select</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
          <option value="probably">Probably</option>
        </select>

        <div id="dynamicSection"></div>
        <div id="suspectInterviewSection"></div>

        <button onclick="create()">Generate FIR</button>
        <button onclick="caseController()">Run Investigation</button>

        <div id="output"></div>

      </div>
    </div>

    <div class="side">
      <div class="profile-box">
        <img id="ds" style="border-radius:50px;"><br><br>

        <b>Name:</b>
        <p id="k"></p>

        <b>ðŸ“ž:</b>
        <p id="l"></p>

        <b>âœ‰:</b>
        <p id="m"></p>

        <b>Signature:</b><br><br>
        <img id="de">
      </div>
    </div>

  </div>

  <div id="dis">
    <input type="text" id="chatInput">
    <button onclick="caseController()">â†’</button>
  </div>

  <div class="footer">
    Anveshan Intelligence can make mistakes, please use it carefully.
  </div>

  <button class="menu-btn" onclick="openMenu()">
  â˜°
</button>

<div id="overlay" class="overlay" onclick="closeMenu()"></div>

<div id="sideMenu" class="side-menu">
  <div class="menu-header">
    <h2>ANVESHAN</h2>
    <button class="close-btn" onclick="closeMenu()">âœ•</button>
  </div>

  <a href="#">New chat</a>
  <a href="#">Save chat</a>
  <a href="#">Delete chat</a>
  <a href="#">View history</a>
  <a href="#">Change password</a>
  <a href="#">Change profilepic</a>
  <a href="#">Notifications</a>
  <a href="#">Help</a>
  <a href="#">About us</a>
  <a href="#">Logout</a>
  
  
</div

</body>
</html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script src="fir(1).js"></script>


<script>

function openMenu(){
  document.getElementById("sideMenu").style.left = "0";
  document.getElementById("overlay").style.display = "block";
  document.querySelector(".menu-btn").style.display = "none";
 }

function closeMenu(){
  document.getElementById("sideMenu").style.left = "-320px";
  document.getElementById("overlay").style.display = "none";
  document.querySelector(".menu-btn").style.display = "block";
 }

let el1=document.getElementById("ds");
let el2=document.getElementById("de");
let el3=document.getElementById("k");
let el4=document.getElementById("l");
let el5=document.getElementById("m");
  

let img1=localStorage.getItem("profilePic");
let img2=localStorage.getItem("signaturePic");
let n1=localStorage.getItem("username1");
let n2=localStorage.getItem("username2");
let n3=localStorage.getItem("username3");

el1.src=img1;
el2.src=img2;
el3.innerText=n1;
el4.innerText=n2;
el5.innerText=n3;
  
let caseData = {};
let policeMode = { active: false };

function addHistory(text){
  let ol = document.getElementById("y");
  let li = document.createElement("li");
  li.style.color = "white";
  li.innerText = text;
  ol.appendChild(li);
}

document.getElementById("victimAlive").addEventListener("change", function() {
  let status = this.value;
  let section = document.getElementById("dynamicSection");

  if (status === "yes") {
    section.innerHTML = `
      <h3>Victim Statement</h3>
      <textarea id="victimStatement"></textarea>
    `;
  } 
  else if (status === "no") {
    section.innerHTML = `
      <h3>Who filed the FIR on behalf of the victim?</h3>
      <input type="text" id="firFiler">
      <h3>Enter that person's statement</h3>
      <textarea id="proxyStatement"></textarea>
    `;
  }
  else {
    section.innerHTML = "";
  }
});

function TCI(caseData) {
  let fir = (caseData.FIR || "").toLowerCase();
  let issues = [];

  if(fir.includes("morning") && fir.includes("midnight")) issues.push("Time contradiction inside FIR.");
  if(fir.includes("knife") && fir.includes("gun")) issues.push("Multiple weapon contradiction inside FIR.");

  caseData.TCI = {
    status: issues.length===0 ? "Consistent" : "Inconsistent",
    issues
  };
  return caseData;
}

function TCA(caseData) {
  let fir = (caseData.FIR || "").toLowerCase();
  let statement = (caseData.StatementUsed || "").toLowerCase();
  let contradictions = [];

  if(statement){
    if(fir.includes("knife") && statement.includes("gun")) contradictions.push("Weapon mismatch between FIR and statement.");
    if(fir.includes("gun") && statement.includes("knife")) contradictions.push("Weapon mismatch between FIR and statement.");
    if(fir.includes("night") && statement.includes("morning")) contradictions.push("Time mismatch between FIR and statement.");
    if(fir.includes("morning") && statement.includes("night")) contradictions.push("Time mismatch between FIR and statement.");
    if(fir.includes("afternoon") && statement.includes("night")) contradictions.push("Time mismatch between FIR and statement.");
    if(fir.includes("morning") && statement.includes("afternoon")) contradictions.push("Time mismatch between FIR and statement.");
    if(fir.includes("night") && statement.includes("afternoon")) contradictions.push("Time mismatch between FIR and statement.");
    if(fir.includes("afternoon") && statement.includes("morning")) contradictions.push("Time mismatch between FIR and statement.");
    if(fir.includes("evening") && statement.includes("night")) contradictions.push("Time mismatch between FIR and statement.");
    if(fir.includes("evening") && statement.includes("morning")) contradictions.push("Time mismatch between FIR and statement.");
    if(fir.includes("evening") && statement.includes("afternoon")) contradictions.push("Time mismatch between FIR and statement.");
    if(fir.includes("morning") && statement.includes("evening")) contradictions.push("Time mismatch between FIR and statement.");
    if(fir.includes("afternoon") && statement.includes("evening")) contradictions.push("Time mismatch between FIR and statement.");
    if(fir.includes("night") && statement.includes("evening")) contradictions.push("Time mismatch between FIR and statement.");
  }

  caseData.TCA = {
    status: contradictions.length===0 ? "Consistent" : "Contradictions Found",
    contradictions
  };
  return caseData;
}

function RLE(caseData){
  let statement = caseData.StatementUsed || "";
  let suspects=[], locations=[], traits=[];

  if(!statement){
    caseData.RLE={suspects,locations,traits};
    return caseData;
  }

  let sentences = statement.match(/[^\.!\?]+[\.!\?]*/g) || [statement];

  const locationKeywords=["mall","market","park","station","hospital","school","bridge","street","road","metro","cafe","hotel","college","university","restaurant","gym","club","home","office"];
  const traitKeywords=["tall","short","beard","scar","jacket","mask","black","white","blue","red","lean","muscular","goatee","pale","large","small","spot","tattoo","burnt"];

  const invalidNames = [
    "me","him","her","them","they","he","she","i","we","you","my","your",
    "man","woman","person","guy","boy","girl","knife","gun","road","market","station"
  ];

  const namePatterns = [
    /name\s+is\s+([A-Z][a-z]+)/g,
    /name\s+might\s+be\s+([A-Z][a-z]+)/g,
    /name\s+could\s+be\s+([A-Z][a-z]+)/g,
    /called\s+([A-Z][a-z]+)/g,
    /shouted\s+([A-Z][a-z]+)/g,
    /known\s+as\s+([A-Z][a-z]+)/g
  ];

  namePatterns.forEach(pattern=>{
    let match;
    while((match = pattern.exec(statement)) !== null){
      let foundName = match[1];
      let lower = foundName.toLowerCase();

      if(!invalidNames.includes(lower) && !suspects.some(s=>s.name.toLowerCase()===lower)){
        suspects.push({
          name: foundName,
          reason: "Detected from name pattern in statement",
          location: null,
          traits: []
        });
      }
    }
  });

  sentences.forEach(sentence=>{
    traitKeywords.forEach(trait=>{
      if(sentence.toLowerCase().includes(trait)) traits.push(trait);
    });

    locationKeywords.forEach(loc=>{
      if(sentence.toLowerCase().includes(loc)) locations.push(loc);
    });
  });

  traits=[...new Set(traits)];
  locations=[...new Set(locations)];

  if(suspects.length===0 && traits.length>0){
    suspects.push({
      name:"Unknown Individual",
      reason:"Described by traits",
      location:locations[0]||null,
      traits:[...traits]
    });
  }

  suspects.forEach(s=>{
    s.location = locations[0] || s.location || null;
    s.traits = [...traits];
  });

  caseData.RLE={suspects,locations,traits};
  return caseData;
}

function FCI(caseData){
  let suspects=caseData.RLE?.suspects || [];
  let baseScore=10;

  suspects.forEach((s,index)=>{
    let score=baseScore + s.traits.length*5 + (s.location?5:0) + index*2 + (s.name!=="Unknown Individual"?5:0);
    s.evidenceScore=score;
  });

  caseData.FCI={
    suspects,
    totalScore:suspects.reduce((acc,s)=>acc+s.evidenceScore,0)
  };
  return caseData;
}

function EAS(caseData){
  if(!caseData.RLE?.suspects) return caseData;

  let totalEvidence=0;
  let highPrioritySuspects=[];

  caseData.RLE.suspects.forEach(s=>{
    let weight=1;

    if(s.traits.length) weight+=0.2*s.traits.length;
    if(s.location) weight+=0.3;
    if(s.interviewStatement) weight+=0.5;
    if(s.alibiWeak) weight+=0.4;
    if(s.contradictions?.length) weight+=0.5;

    s.finalScore=Math.round((s.evidenceScore || 10)*weight);
    totalEvidence+=s.finalScore;

    if(s.finalScore>=40) highPrioritySuspects.push(s.name);
  });

  caseData.EAS={totalEvidenceScore:totalEvidence,highPrioritySuspects};
  return caseData;
}

function policeQuestionEngine(){
  if(!caseData.stage) caseData.stage = "interview";

  if(caseData.TCI?.issues?.length){
    caseData.stage = "contradiction";
    return "Your FIR has contradictions: " + caseData.TCI.issues.join(" | ") + ". Please clarify correct details.";
  }

  if(caseData.TCA?.contradictions?.length){
    caseData.stage = "contradiction";
    return "Contradiction found between FIR and statement: " + caseData.TCA.contradictions.join(" | ") + ". Which is correct?";
  }

  if(!caseData.RLE?.suspects || caseData.RLE.suspects.length===0){
    caseData.stage = "suspect_discovery";
    return "No suspects identified. Did the victim mention any name, relationship, or dispute?";
  }

  if(caseData.stage === "interview"){
    let pending = caseData.RLE.suspects.find(s=>!s.interviewStatement);
    if(pending){
      return `Interview suspect ${pending.name}: Where were you during the incident time (${caseData.Date || "Unknown Date"} ${caseData.Time || ""})? Provide alibi.`;
    } else {
      caseData.stage = "evidence";
    }
  }

  if(caseData.stage === "evidence"){
    if(!caseData.externalEvidence){
      return "All suspects interviewed. Do you have CCTV evidence, call records, or witness names to verify alibis?";
    } else {
      caseData.stage = "analysis";
    }
  }

  if(caseData.stage === "analysis"){
    return "Evidence recorded. Type FINAL to generate ranking or type RECHECK to re-check suspects.";
  }

  if(caseData.stage === "final"){
    return "Final ranking generated. Investigation complete.";
  }

  return "Investigation ongoing. Provide more inputs.";
}

function updateFromPoliceAnswer(answer){
  answer = answer.trim();
  if(!answer) return;

  if(!caseData.StatementUsed) caseData.StatementUsed = "";
  caseData.StatementUsed += " " + answer;

  if(caseData.stage === "analysis"){
    if(answer.toLowerCase().includes("final")){
      caseData.stage = "final";
      return;
    }
    if(answer.toLowerCase().includes("recheck")){
      caseData.stage = "interview";
      caseData.externalEvidence = null;
      return;
    }
  }

  if(caseData.stage === "evidence"){
    caseData.externalEvidence = answer;
    caseData.stage = "analysis";
    return;
  }

  let pendingIndex = caseData.RLE.suspects.findIndex(s=>!s.interviewStatement);
  if(pendingIndex !== -1){
    let suspect = caseData.RLE.suspects[pendingIndex];
    suspect.interviewStatement = answer;

    if(answer.toLowerCase().includes("alone")){
      suspect.alibiWeak = true;
      suspect.contradictions = suspect.contradictions || [];
      suspect.contradictions.push("Weak alibi: claims alone.");
    }
  }
}

function renderOutput(){
  const outputDiv=document.getElementById("output");
  if(!caseData) return;

  let suspectsHtml = "None";

  if(caseData.RLE?.suspects?.length){
    suspectsHtml = caseData.RLE.suspects.map(s=>`
      <p>
        <b>Name:</b> ${s.name}<br>
        <b>Reason:</b> ${s.reason}<br>
        <b>Location:</b> ${s.location || "Unknown"}<br>
        <b>Traits:</b> ${s.traits.join(", ") || "None"}<br>
        <b>Evidence Score (FCI):</b> ${s.evidenceScore || 0}<br>
        <b>Final Score (EAS):</b> ${s.finalScore || 0}<br>
        <b>Interview:</b> ${s.interviewStatement ? "Provided" : "Pending"}<br>
        <b>Contradictions:</b> ${(s.contradictions||[]).join(", ") || "None"}<br>
      </p>
      <hr>
    `).join("");
  }

  outputDiv.innerHTML = `
    <h3>Investigation Report</h3>
    <p><b>TCI:</b> ${caseData.TCI?.status || "N/A"}</p>
    <p><b>TCA:</b> ${caseData.TCA?.status || "N/A"}</p>

    <h4>Suspects Identified:</h4>
    ${suspectsHtml}

    <p><b>Total Case Evidence Score:</b> ${caseData.EAS?.totalEvidenceScore || 0}</p>
    <p><b>High-Priority Suspects:</b> ${caseData.EAS?.highPrioritySuspects?.join(", ") || "None"}</p>

    <hr>
    <h4>Next Police Question</h4>
    <p>${policeQuestionEngine()}</p>
  `;
}

function SIM(){
  if(!caseData.RLE?.suspects) return;

  const section=document.getElementById("suspectInterviewSection");
  section.innerHTML="<h3>Suspect Interviews</h3>";

  caseData.RLE.suspects.forEach((s,index)=>{
    section.innerHTML += `
      <div class="suspect-section">
        <b>Suspect ${index+1}: ${s.name}</b><br><br>

        <label>Interview Statement:</label><br>
        <textarea id="suspectStmt_${index}" placeholder="Enter statement for ${s.name}">${s.interviewStatement || ""}</textarea><br>

        <button onclick="saveInterview(${index})">Save Statement</button>
      </div>
    `;
  });
}

function saveInterview(index){
  let textarea=document.getElementById(`suspectStmt_${index}`);
  if(!textarea) return;

  let statement=textarea.value.trim();
  if(!statement){
    alert("Statement cannot be empty.");
    return;
  }

  let s=caseData.RLE.suspects[index];
  s.interviewStatement=statement;

  if(statement.toLowerCase().includes("alone")){
    s.alibiWeak = true;
    s.contradictions = s.contradictions || [];
    if(!s.contradictions.includes("Weak alibi: claims alone.")){
      s.contradictions.push("Weak alibi: claims alone.");
    }
  }

  updatePipeline();
  alert(`Statement for ${s.name} saved successfully.`);
}

function mergeSuspects(oldSuspects, newSuspects){
  newSuspects.forEach(ns=>{
    let existing = oldSuspects.find(os=>os.name.toLowerCase() === ns.name.toLowerCase());
    if(existing){
      ns.interviewStatement = existing.interviewStatement || ns.interviewStatement;
      ns.alibiWeak = existing.alibiWeak || ns.alibiWeak;
      ns.contradictions = existing.contradictions || ns.contradictions;
    }
  });
  return newSuspects;
}

function updatePipeline(){
  let oldSuspects = caseData.RLE?.suspects ? JSON.parse(JSON.stringify(caseData.RLE.suspects)) : [];

  caseData = TCI(caseData);
  caseData = TCA(caseData);
  caseData = RLE(caseData);

  if(oldSuspects.length > 0){
    caseData.RLE.suspects = mergeSuspects(oldSuspects, caseData.RLE.suspects);
  }

  caseData = FCI(caseData);
  caseData = EAS(caseData);

  localStorage.setItem("Current_Case", JSON.stringify(caseData));

  SIM();
  renderOutput();
}

function execute(){
  let fir=document.getElementById("firDetails").value.trim();
  let victimAlive=document.getElementById("victimAlive").value;

  if(!fir || !victimAlive){
    alert("Complete required fields.");
    return;
  }

  document.getElementById("dis").style.display = "flex";

  let statementToCompare="", firFiler="";

  if(victimAlive==="Yes"){
    statementToCompare=document.getElementById("victimStatement")?.value.trim() || "";
  }

  if(victimAlive==="No"){
    firFiler=document.getElementById("firFiler")?.value.trim() || "";
    statementToCompare=document.getElementById("proxyStatement")?.value.trim() || "";
  }

   if(victimAlive==="Probably"){
    firFiler=document.getElementById("firFiler")?.value.trim() || "";
    statementToCompare=document.getElementById("proxyStatement")?.value.trim() || "";
  }

  caseData={
    FIR: fir,
    VictimAlive: victimAlive,
    FIR_Filer: firFiler,
    StatementUsed: statementToCompare,
    Date: document.getElementById("date")?.value || "",
    Time: document.getElementById("startTime")?.value || "",
    Weapon: document.getElementById("weaponUsed")?.value || "",
    Location: document.getElementById("location")?.value || "",
    IncidentType: document.getElementById("incidentType")?.value || ""
  };

  updatePipeline();
}

function caseController(){
  
  let chatAnswer = document.getElementById("chatInput").value.trim();

  if(!policeMode.active){
    execute();
    policeMode.active = true;
    addHistory("SYSTEM: Case file created. Investigation started.");
    addHistory("POLICE: " + policeQuestionEngine());
    document.getElementById("chatInput").value="";
    return;
  }

  if(chatAnswer){
    addHistory("USER: " + chatAnswer);
    updateFromPoliceAnswer(chatAnswer);
    document.getElementById("chatInput").value="";
    updatePipeline();
    addHistory("POLICE: " + policeQuestionEngine());
    return;
  }

  alert("Enter answer in chat input.");
}
</script>




